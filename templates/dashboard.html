{% extends 'base.html' %}
{% block content %}
<h2>Dashboard</h2>
<div class="row">
  <div class="col-md-6">
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title text-primary">Weekly Progress</h5>
        <p id="weekly-stats" class="card-text">{{ weekly_played }} / {{ weekly_goal }} minutes</p>
        <div class="progress">
          <div id="weekly-progress-bar" class="progress-bar bg-primary" role="progressbar" style="width: {{ pct_played }}%;">{{ pct_played }}%</div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card mb-4">
      <div class="card-body text-center">
        <h5 class="card-title text-primary">High Score</h5>
        <div id="high-score" class="display-4">{{ high_score }}</div>
      </div>
    </div>
  </div>
</div>
<script>
  // Fetch and update dashboard metrics
  function updateMetrics() {
    fetch("{{ url_for('api_metrics') }}")
      .then(res => res.json())
      .then(data => {
        document.getElementById('weekly-stats').textContent = `${data.weekly_played} / ${data.weekly_goal} minutes`;
        const bar = document.getElementById('weekly-progress-bar');
        bar.style.width = `${data.pct_played}%`;
        bar.textContent = `${data.pct_played}%`;
        document.getElementById('high-score').textContent = data.high_score;
      });
  }
  updateMetrics();
  setInterval(updateMetrics, 30000);
</script>
{% endblock %}
<script>
  // Auto-refresh dashboard metrics via AJAX
  function updateMetrics() {
    fetch("{{ url_for('api_metrics') }}")
      .then(res => res.json())
      .then(data => {
        document.getElementById('weekly-stats').textContent = `${data.weekly_played} / ${data.weekly_goal} minutes`;
        const bar = document.getElementById('weekly-progress-bar');
        bar.style.width = `${data.pct_played}%`;
        bar.textContent = `${data.pct_played}%`;
        document.getElementById('high-score').textContent = data.high_score;
      });
  }
  // initialize and update every 30s
  updateMetrics();
  setInterval(updateMetrics, 30000);
</script>
